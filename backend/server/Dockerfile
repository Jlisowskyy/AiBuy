FROM python:3.9-slim AS base

################################################################################
#                                    server                                    #
################################################################################


#------------------------------------------------------------------------------#
#                               Dependency Stage                               #
#------------------------------------------------------------------------------#

FROM base AS dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir --upgrade -r requirements.txt


#------------------------------------------------------------------------------#
#                                Runtime Stage                                 #
#------------------------------------------------------------------------------#

FROM dependencies AS runtime
EXPOSE 80/tcp
COPY . .
CMD ["python", "-m", "uvicorn", "app.main:app", "--proxy-headers", "--port", "80"]
